# Alpaca Local 量化交易平台 (Powered by Trae)

这是一个基于 Trae IDE 和 Alpaca API 搭建的全栈量化交易解决方案。它打通了从**本地策略开发** -> **历史数据回测** -> **云端自动实盘**的完整闭环。

---

## 🛠️ 第一阶段：策略开发 (Trae 本地环境)

在这里，你利用 Trae 的 AI 能力快速编写和迭代交易逻辑。

### 1.1 核心文件
- **`strategy.py`**: **策略大脑**。所有的买卖逻辑都写在这里。
    - 当前默认策略：**布林带 (Bollinger Bands) + RSI 组合策略**。
    - 动态仓位：根据波动率自动调整每次下单的股数。
- **`paper_account_api_key.txt`**: 你的 Alpaca API 密钥（**严禁上传**）。

### 1.2 如何开发新策略
不需要手动写复杂的数学公式，直接在 Trae 的 Chat 窗口输入：
> "帮我修改 strategy.py，加入 MACD 指标作为过滤条件。"
> "帮我修改仓位管理逻辑，亏损超过 5% 强制止损。"

Trae 会自动帮你重写 `strategy.py` 中的代码。

---

## 📊 第二阶段：本地回测 (Backtesting)

在投入真金白银（或模拟资金）之前，必须验证策略的历史表现。

### 2.1 运行回测
在 Trae 终端中运行：
```bash
python3 backtest.py
```

### 2.2 查看结果
脚本运行结束后：
1. **终端输出**: 显示总收益率、买入持有收益率、最终资金额。
2. **可视化图表**: 左侧文件列表会自动生成 **`backtest_result.png`**。点击打开，即可看到策略资金曲线 vs 股价走势的对比图。

---

## ☁️ 第三阶段：云端实盘验证 (Cloud Deployment)

为了验证策略的稳定性，建议在 AWS 等云服务器上进行 1-2 个月的模拟盘跑测。

### 3.1 首次部署 (AWS)
请详细阅读 **[DEPLOYMENT.md](DEPLOYMENT.md)** 文档，它包含了从购买服务器到配置环境的保姆级教程。

### 3.2 日常运维与更新
我们实现了一套**自动化发布流程**，无需手动登录服务器改代码。

**场景：你在本地 Trae 修改并回测好了新策略，想更新到云端。**

1.  **本地发布 (Trae 端)**:
    ```bash
    ./local_publish.sh
    ```
    *功能：自动将代码提交并推送到 GitHub。*

2.  **云端更新 (AWS 端)**:
    登录 AWS 网页终端 (Instance Connect) 或使用 SSH，运行：
    ```bash
    ./remote_update.sh
    ```
    *功能：自动拉取最新代码，并重启后台交易机器人。*

### 3.3 收益追踪
机器人每天会在美东时间 09:35 自动运行，并将结果记录在服务器的 `performance_log.csv` 中。

**如何查看实盘曲线？**
你可以随时在服务器上运行：
```bash
python3 track_performance.py
```
它会生成 `live_performance.png`，你可以下载下来查看最新的实盘资金曲线。

---

## ⚠️ 注意事项

1.  **PDT 规则**: 如果你的账户资金小于 $25,000，频繁进行日内交易（Day Trade）可能会被限制。本策略包含基本的 PDT 保护逻辑，但建议保持资金充足。
2.  **数据延迟**: 免费的 Alpaca 账户使用的是 IEX 数据源，部分请求可能有 15 分钟延迟。实盘建议升级到 Alpaca Unlimited 数据订阅。
3.  **密钥安全**: 永远不要将 `paper_account_api_key.txt` 上传到 GitHub。我们的 `.gitignore` 已经为你做好了防护。
